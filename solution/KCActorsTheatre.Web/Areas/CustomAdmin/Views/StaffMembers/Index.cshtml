@using Clickfarm.Cms.Mvc
@model KCActorsTheatre.Web.Areas.CustomAdmin.ViewModels.StaffMembers.IndexViewModel
@{
    ViewBag.HtmlTitle = Model.DescriptionPlural;
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}
@section styles
{
    <link href="/areas/customadmin/common/css/admin.css" rel="stylesheet" type="text/css" />
}
@section scripts
{
    <script type="text/javascript" src="@Url.CdnResource("/common/js/knockout-plugins/mapping/2.3.5/knockout.mapping-2.3.5.js")"></script>
    <script type="text/javascript" src="/areas/customadmin/common/js/shared/item.js"></script>
    <script type="text/javascript" src="/areas/customadmin/common/js/shared/item-create.js"></script>
    <script type="text/javascript" src="/areas/customadmin/common/js/shared/item-index.js"></script>
    <script type="text/javascript">
        window.TitleList = [ @Html.Raw(string.Join(",", Model.RoleTitles.Select(rt => "'" + rt + "'"))) ];
        var STAFF_TYPE = '@Model.StaffType';
    </script>
    <script type="text/javascript" src="/areas/customadmin/common/js/staff-members/staff-roles.js"></script>
    <script type="text/javascript" src="/areas/customadmin/common/js/staff-members/staff-roles-create.js"></script>
    <script type="text/javascript" src="/areas/customadmin/common/js/staff-members/index.js"></script>
    @if (Model.EditStaffMember != null)
    {
        <script>
            // if EditID passed in, open item in new tab
            $().ready(function () {
                var itemsManager = admin.items.getClosestItemsManager('#items');
                var viewModel = itemsManager.getViewModel();
                viewModel.tabMgr.addTab(new TabInfo(
                    admin.editItemURL + '/@Model.EditStaffMember.StaffMemberID',
                    cms.truncateStr('@Model.EditStaffMember.SortName', 20),
                    'edit-item',
                    admin.items.uniqueIDForTab(@Model.EditStaffMember.StaffMemberID)
                ));
            });
        </script>
    }
}
<div id="items" class="items-container">
    <div id="tabs">
        <a href="#" id="close-tabs-link" data-bind="visible: tabMgr.tabs().length > 1, click: tabMgr.closeAllTabs" title="Close all">Close all</a>
        <ul>
            <li class="tab-notclosable"><a href="#primary-tab">@Model.DescriptionPlural</a></li>
        </ul>
        <div id="primary-tab">
            <div class="ui-toolbar-cms">
                <a id="create-item" href="#">@Model.DescriptionSingular</a>
            </div>
            <div class="tab-options-wrapper">
                <div id="start-options" class="tab-options">
                    <h3><a>@Model.DescriptionPlural</a></h3>
                    <div>
                        <div>
                            <label for="find-items-name">Find By Name:</label><br />
                            <input type="text" id="find-items-name" />
                            <a id="show-all-items" style="margin-top: 10px" href="#">Show All</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-display">
                <div id="find-items-results" data-bind="visible: findResultsVisible" class="tab-display-panel ui-dialog ui-widget ui-widget-cms ui-widget-content ui-corner-all ui-state-highlight">
                    @Html.TitleBar(Model.DescriptionPlural + " Found", true, "close-find-items-results", "click: closeFindResults")
                    <div class="wrapper">
                        <div data-bind="visible: retrievingItems">
                            <img src="@Url.AjaxLoader()" alt="Looking..." />
                            Looking...
                        </div>
                        <table class="items-table table-layout" data-bind="visible: !retrievingItems() && anyItems()">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Phone</th>
                                    <th>Email</th>
                                    <th>Last Modified</th>
                                </tr>
                            </thead>
                            <tbody data-bind="foreach: items">
                                <tr data-bind="attr: { 'data-item-id': ID }">
                                    <td>
                                        <a href="#" data-bind="click: function () { $parent.showEditItem($data); }, text: Name, attr: { 'data-item-id': ID }"></a>
                                    </td>
                                    <td data-bind="text: Phone"></td>
                                    <td data-bind="text: Email"></td>
                                    <td data-bind="text: DateModified"></td>
                                </tr>
                            </tbody>
                        </table>
                        <div data-bind="visible: !retrievingItems() && !anyItems()">No @Model.DescriptionPlural were found.</div>
                    </div>
                </div>
                <div id="recent-items" data-bind="visible: recentItems().length > 0" class="tab-display-panel ui-dialog ui-widget ui-widget-cms ui-widget-content ui-corner-all ui-state-highlight">
                    @Html.TitleBar("Recent " + Model.DescriptionPlural)
                    <div class="wrapper">
                        <ul data-bind="foreach: recentItems">
                            <li><a href="#" data-bind="click: function () { $parent.showEditItem($data); }, text: Name, attr: { 'data-item-id': ID }"></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <br class="clear" />
        </div>
    </div>
</div>

<div id="create-item-form" class="model-display edit-not-in-place hidden" title="New @Model.DescriptionSingular">
    <div class="ui-widget-content ui-corner-all ui-widget-cms">
        @using (Ajax.BeginForm("Create", "StaffMembers",
            new AjaxOptions
            {
                HttpMethod = "Post",
                LoadingElementId = "create-item-loading",
                OnFailure = "createItemManager.ajaxFailure",
                OnSuccess = "createItemManager.ajaxSuccess"
            }
        ))
        {
            <div class="display-field">
                @Html.LabelFor(m => m.StaffMember.FirstName)
                @Html.TextBoxFor(m => m.StaffMember.FirstName, new { @class = "dialog-textbox required", @id = "create-item-name" })<br />
                @Html.ValidationMessageFor(m => m.StaffMember.FirstName)
                @Html.LabelFor(m => m.StaffMember.LastName)
                @Html.TextBoxFor(m => m.StaffMember.LastName, new { @class = "dialog-textbox required", @id = "create-item-last-name" })<br />
                @Html.ValidationMessageFor(m => m.StaffMember.LastName)
            </div>
            
            <input type="hidden" name="TypeofStaffMember" value="@Model.TypeofStaffMember.AssemblyQualifiedName" />
            
        }
    </div>
    <div id="create-item-loading">
        <div class="throbber">
            @* loading animation*@
        </div>
    </div>
    <div id="create-item-error" class="ajax-error"></div>
</div>

<div id="create-role-form" class="model-display edit-not-in-place hidden" title="New Role">
    <div class="ui-widget-content ui-corner-all ui-widget-cms">
        @using (Ajax.BeginForm("CreateRole", "StaffMembers",
            new AjaxOptions
            {
                HttpMethod = "Post",
                LoadingElementId = "create-role-loading",
                OnFailure = "createRoleManager.ajaxFailure",
                OnSuccess = "createRoleManager.ajaxSuccess"
            }
        ))
        {
            <div class="display-field">

                @Html.LabelFor(m => m.RoleDefinition.Title)
                @Html.TextBoxFor(m => m.RoleDefinition.Title, new { @class = "dialog-textbox required", @id = "create-role-title" })<br />
                @Html.ValidationMessageFor(m => m.RoleDefinition.Title)

                <div id="create-mission-center-container">
                    <label for="RoleDefinition.MissionCenter">Mission Center</label>
                    @Html.DropDownListFor(m => m.RoleDefinition.MissionCenter, Model.MissionCenterList, new { Name = "RoleDefinition.MissionCenterID", @class = "dialog-textbox required,", @id = "create-role-mission-center" })<br />
                </div>

                <div id="create-mission-field-container">
                    <label for="RoleDefinition.MissionField">Mission Field</label>
                    @Html.DropDownListFor(m => m.RoleDefinition.MissionField, Model.MissionFieldList, new {  Name = "RoleDefinition.MissionFieldID", @class = "dialog-textbox required,", @id = "create-role-mission-field" })<br />
                </div>

                <input type="hidden" name="RoleDefinition.Role" id="create-role-type" value="" />
                <input type="hidden" name="RoleDefinition.StaffMemberID" id="create-role-member-id" value="" />

            </div>
        }
    </div>
    <div id="create-role-loading">
        <div class="throbber">
            @* loading animation*@
        </div>
    </div>
    <div id="create-item-error" class="ajax-error"></div>
</div>